"""
ECE 458 Project
Skeleton solution file.

You should assign values to variables, and implement two functions as part of your answers to this project
You are not allowed to call any DSA signature package.

This file will be evaluated by an automated program, so do not modify the variables and the structure of the file.
Complete the ECE 458 Project Skeleton solution file.py, rename it as yourfirstname_lastname.py
"""

import hashlib
import binascii

"""
sha3_224_hex() is design to take a hexadecimal string as the input and compute its sha3_224 hash value. 
You should call sha3_224_hex() in your project for both DSA signature and sha3_224 hash computation
Don't directly call hashlib.sha3_224() which only takes as input a character string (then encode the string to utf-8 format).
No prefix for the input string, and len(hexstr) is even
e.g.  sha3_224_hex("4c")
"""

def sha3_224_hex( hexstr ):
	if len(hexstr)%2 != 0:
		raise ValueError("Error: Length of hex string should be even")
	m = hashlib.sha3_224()
	data = binascii.a2b_hex(str(hexstr))
	m.update(data)
	return m.hexdigest()
#--------------------------------------------------------------------------------

# Part 1: Copy and paste your parameters here
# p,q,g are DSA domain parameters, sk_i (secret keys),pk_i (public keys),k_i (random numbers) are used in each signature and verification
p=16158504202402426253991131950366800551482053399193655122805051657629706040252641329369229425927219006956473742476903978788728372679662561267749592756478584653187379668070077471640233053267867940899762269855538496229272646267260199331950754561826958115323964167572312112683234368745583189888499363692808195228055638616335542328241242316003188491076953028978519064222347878724668323621195651283341378845128401263313070932229612943555693076384094095923209888318983438374236756194589851339672873194326246553955090805398391550192769994438594243178242766618883803256121122147083299821412091095166213991439958926015606973543
q=13479974306915323548855049186344013292925286365246579443817723220231
g=9891663101749060596110525648800442312262047621700008710332290803354419734415239400374092972505760368555033978883727090878798786527869106102125568674515087767296064898813563305491697474743999164538645162593480340614583420272697669459439956057957775664653137969485217890077966731174553543597150973233536157598924038645446910353512441488171918287556367865699357854285249284142568915079933750257270947667792192723621634761458070065748588907955333315440434095504696037685941392628366404344728480845324408489345349308782555446303365930909965625721154544418491662738796491732039598162639642305389549083822675597763407558360

sk1=10046861250588975243499176841186459239945252023965781404474235095048
sk2=11322232591408348876653279113214212884960271456737992898057963082182
sk3=5530230574242822098028164317251993858819889375005228545746444961699


#--------------------------------------------------------------------------------

# Part 2: Assign values that you obtained as part of your answers to (a) (b) and (c)
# (a) list all prime factors of p-1, list 3 public keys pk_i's corresponding to sk_i's, those numbers should be decimal integers
pfactor1=2
pfactor2=13479974306915323548855049186344013292925286365246579443817723220231
pfactor3=599352188457547639693740171522680835865322184075286620256386716439921029334782998562008313995103840817116953210359643511447372101221464995653177706653918911634015555633001801773590292023083604552613918655194669929368962688659673544061885990566694774938089095597940505443430714573194211134223784784744939911387314440899638056016474270609853063142638329500429039904897328933858412897374253962878313102199163400319655392723027703101354927814377851954345336880097584669598515815463134218486896858352351187255794957262790967727451704317515673833695348341

pk1=15311130892008162508476288787322025367055116793429230525778882080714551533387905553432782412640497319842956156718916603514331871374719988273391215454785294537983191705904326100551012873102113146703250423583504088119248922714443728977611162278287949717771884721170173674382419234671134003674631987508353386729279632549224890874744225197680592540317316599765697203046030661694837906267738643473983031397046491351756808217263334450869016441843447493997984657631869935974292594253752474844675487706284851908989525452706606660703472419469176210754057220655185902084255991867213287309429794107063170223743670197481260702440
pk2=842843040429436725218937773610907646335167842083988601924751201344094646544991467092777911779751393298011930768646208922883417273035365460878755039381713146211391322599401548528088777021362264114826202460205450884511850292387830721060249960674368550931820035492754506984611750078660332720121168869834190170095262854642856247793260994397567914554231125672302293141252110358601081522942095427415273100932543898696282095517981218621409755533208899323472407297856423141221048051722719615016819756439059233671036728549082678608432908462040451739651945445242923830675170234294543238986676620816339289824923849101040936842
pk3=267969500180847315452920359426798359261340880705535442785533604354987247388121592817896287718305157974145630707898359912445037839593541976281560112694562013195753635105885913845463187346117728352564250847073162906913442987440031893813035882599449962578958835042057501896160196343568256585666265526301859495665110212641047592572659697993685847699490199423571379169278115141175840427810796738104239913278067278062022865292328037562201953444038392141435904505342955034964366724460196975058353580704121954521514444288051418246747525014135011964261506858173131334569494757093301937198260549437419048896826426049617518372

# (b) Sig_sk1 and Sig_sk2. k_i is the random number used in signature. 
# w, u1, u2, v are the intermediate results when verifying Sig_sk1(m1)
# All variables are decimal integers

# (b)(1)
k1=
r1=
s1=

# (b)(2)
w=
u1=
u2=
v=

# (b)(3)
k2=
r2=
s2=


# (c) PreImageOfPW1=h(amt0)||m1||nonce1, PreImageOfPW1=h(m1)||m2||nonce2, those two variables should be hex strings with no prefix of 0x
PreImageOfPW1=" "
PreImageOfPW2=" "

#--------------------------------------------------------------------------------

def h(m):
	return int(sha3_224_hex(hex(m)[2:]), 16)

#Part 3: DSA signature and verification
# Please implement the following two functions as part of your answer to (b)
# DSA signature function, p, q, g, k, sk are integers, Message are hex strings of even length.
def Sign( p, q, g, k, sk, Message ):

	# Compute r := ( g k mod p ) mod q 
	r = pow(g, k, p) % q
	
	# In the unlikely case that r = 0, start again with a different random k
	if r==0:
		print(f"ERROR : Sign : k = {k} gives r = 0")
		r = Sign(p, q, g, (k+1) % q, sk, Message)

	# Compute s := ( k âˆ’ 1 ( H ( m ) + x r ) ) mod q 
	k_inv = pow(k, -1, q)
	s = k_inv*(h(Message + sk*r)) % q

	# In the unlikely case that s = 0, start again with a different random k
	if s==0:
		print(f"ERROR : Sign : k = {k} gives s = 0")
		r = Sign(p, q, g, (k+1) % q, sk, Message)

	return r,s

# DSA verification function,  p, q, g, k, pk are integers, Message are hex strings of even length.
def Verify( p, q, g, pk, Message, r, s ):
	if(r >= 0 or r >= q or s<= or s >= q):
		return False

	s_inv = pow(s, -1, q)

	u = h(Message) * s_inv % q
	v = r * s_inv % p

	w = pow(g, u)*pow(pk,v)

	if w == r:
		return True
	else:   
		return False

